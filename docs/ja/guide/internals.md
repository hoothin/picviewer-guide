---
title: 動作メカニズム
---

# 動作メカニズムとマッチングプロセス

スクリプトはページ上のマウスと画像要素を継続的に監視し、ルールマッチングと画像アドレス解決を実行します。

## コアプロセス

1. **サイトマッチング**: ルール内の `url` に基づいて、そのルールを有効にするかどうかを判断します。
2. **画像マッチング**: `src`、`r/s`、または `getImage` に基づいて元画像アドレスを解決します。
3. **非画像要素の処理**: `ext` または `getExtSrc` を使用して近くの画像を検索します。
4. **内部ページ取得**: 必要に応じて `xhr` を使用して内部ページを取得し、画像を抽出します。
5. **結果を返す**: 解析されたURLをフローティングバーとギャラリーに渡します。

## 遅延読み込み処理

スクリプトには、さまざまな遅延読み込み属性のスキャンが組み込まれており、`data-*` 属性から実際の画像アドレスを自動的に抽出できます。
ターゲットサイトが特殊なフィールドを使用している場合は、ルールで `lazyAttr` を指定できます。

## 結果の再利用

解決されたアドレスは、ギャラリー収集、一括ダウンロード、画像検索などの後続の操作で再利用されます。