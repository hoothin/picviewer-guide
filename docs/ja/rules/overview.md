---
title: ルール概要
---

# ルール概要

ルールシステムは、サムネイル、遅延読み込み画像、または内部ページの画像を「ダウンロード可能な元画像」に変換する役割を果たします。ルールは複数のフィールドで構成され、2つのモードに分かれています：

- JSONモード：純粋なデータルール、安全でメンテナンスが容易。
- JSモード：関数ロジックを記述可能、複雑なサイトに適しています。

## マッチングプロセス

1. `url` に基づいてサイトが一致するかどうかを判断します（`url` がない場合は全サイトと見なされます）。
2. `src`、`r/s`、または `getImage` に基づいて元画像を取得します。
3. ターゲットが画像要素でない場合は、`ext` または `getExtSrc` を使用します。
4. 内部ページの取得が必要な場合は、`xhr` を使用します。
5. 結果をフローティングバーとギャラリーに返します。

## マッチング優先順位

同じサイトで複数のルールがヒットした場合、ルールの順序に従って実行されます。推奨事項：

- 具体的なサイトルールを最初に記述します（`url` 限定）。
- 次に、グローバルな一般ルールを記述します（`src` または `r/s`）。

## 戻り値のルール

- string：単一画像のURL。
- array：複数画像のURL。
- object：`{ url: [], cap: '' }` 形式で、画像と説明を同時に返します（`xhr` で一般的）。

## 一般的なフィールド

| フィールド | 機能 |
| --- | --- |
| `name` | ルール名 |
| `url` | サイトマッチ |
| `src` | 画像マッチ |
| `r` / `s` | 置換ルール |
| `lazyAttr` | 遅延読み込み属性 |
| `ext` | 隣接要素からの画像取得 |
| `getImage` | JSロジックによる画像取得 |
| `getExtSrc` | 非画像要素からの取得 |
| `xhr` | 内部ページ取得 |
| `clickToOpen` | クリックして開く |
| `exclude` | 除外ルール |

## パフォーマンスのヒント

- 可能な限り `xhr` ではなく `r/s` を使用してください。
- `xhr` は必要な場合にのみ使用し、`url` とセレクターの範囲をできるだけ制限してください。
- ルールが正確であるほど、誤検知が少なくなり、全体的なパフォーマンスが安定します。