---
title: Обзор правил
---

# Обзор правил

Система правил отвечает за преобразование миниатюр, лениво загружаемых изображений или изображений с внутренних страниц в «скачиваемые оригиналы». Правила состоят из нескольких полей и делятся на два режима:

- Режим JSON: Чистые данные правил, безопасные и простые в обслуживании.
- Режим JS: Позволяет писать логику функций, подходит для сложных сайтов.

## Процесс сопоставления

1. Определение соответствия сайта на основе `url` (отсутствие `url` подразумевает все сайты).
2. Получение оригинала на основе `src`, `r/s` или `getImage`.
3. Если цель не является элементом изображения, используется `ext` или `getExtSrc`.
4. Использование `xhr` при необходимости получения данных с внутренних страниц.
5. Возврат результата в плавающую панель и галерею.

## Приоритет сопоставления

Когда несколько правил совпадают с одним сайтом, они выполняются в порядке очередности. Рекомендации:

- Сначала пишите конкретные правила для сайта (ограниченные `url`).
- Затем пишите глобальные общие правила (`src` или `r/s`).

## Правила возвращаемых значений

- string: URL одного изображения.
- array: URL нескольких изображений.
- object: Формат `{ url: [], cap: '' }` для одновременного возврата изображений и описаний (часто встречается в `xhr`).

## Основные поля

| Поле | Назначение |
| --- | --- |
| `name` | Название правила |
| `url` | Сопоставление сайта |
| `src` | Сопоставление изображения |
| `r` / `s` | Правило замены |
| `lazyAttr` | Атрибут ленивой загрузки |
| `ext` | Изображение из соседнего элемента |
| `getImage` | Получение изображения через JS |
| `getExtSrc` | Получение из не-изображения |
| `xhr` | Запрос внутренней страницы |
| `clickToOpen` | Клик для открытия |
| `exclude` | Исключающее правило |

## Советы по производительности

- Предпочитайте `r/s` вместо `xhr`, когда это возможно.
- Используйте `xhr` только при необходимости и максимально ограничивайте область действия `url` и селектора.
- Чем точнее правило, тем меньше ложных срабатываний и стабильнее общая производительность.