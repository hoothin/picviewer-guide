---
title: 運行機制與匹配流程
---

# 運行機制與匹配流程

腳本會在頁面中持續監聽鼠標與圖片元素，並執行規則匹配與圖片地址解析。

## 核心流程

1. **匹配站點**：根據規則中的 `url` 判斷是否啟用該條規則。
2. **匹配圖片**：根據 `src`、`r/s` 或 `getImage` 解析原圖地址。
3. **處理非圖元素**：通過 `ext` 或 `getExtSrc` 尋找附近圖片。
4. **內頁抓取**：必要時使用 `xhr` 抓取內頁並提取圖片。
5. **返回結果**：將解析出的 URL 交給浮動工具欄與畫廊。

## 處理懶加載

腳本內置多種懶加載屬性掃描，可自動從 `data-*` 屬性中提取真實圖片地址。
如果目標站點使用特殊字段，可在規則中指定 `lazyAttr`。

## 結果復用

解析完成的地址會在後續操作中復用，例如畫廊收集、批量下載與以圖搜圖。