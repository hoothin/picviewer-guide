---
title: 規則總覽
---

# 規則總覽

規則系統負責將縮略圖、懶加載圖或內頁圖轉換為「可下載的原圖」。規則由多個字段組合，分為兩種模式：

- JSON 模式：純數據規則，安全、易維護。
- JS 模式：可寫函數邏輯，適合複雜站點。

## 匹配流程

1. 依據 `url` 判斷站點是否匹配（未寫 `url` 視為全站）。
2. 依據 `src`、`r/s` 或 `getImage` 獲取原圖。
3. 若目標不是圖片元素，使用 `ext` 或 `getExtSrc`。
4. 需要內頁抓取時使用 `xhr`。
5. 返回結果交給浮動工具欄與畫廊。

## 匹配優先級

同一站點命中多條規則時，按規則順序執行。建議：

- 先寫精確站點規則（`url` 限定）。
- 再寫全局通用規則（`src` 或 `r/s`）。

## 返回值規則

- string：單圖地址。
- array：多圖地址。
- object：`{ url: [], cap: '' }` 形式用於同時返回圖片與描述（常見於 `xhr`）。

## 常用字段

| 字段 | 作用 |
| --- | --- |
| `name` | 規則名稱 |
| `url` | 站點匹配 |
| `src` | 圖片匹配 |
| `r` / `s` | 替換規則 |
| `lazyAttr` | 懶加載字段 |
| `ext` | 鄰近元素取圖 |
| `getImage` | JS 邏輯獲取圖 |
| `getExtSrc` | 非圖元素取圖 |
| `xhr` | 內頁抓取 |
| `clickToOpen` | 點擊打開 |
| `exclude` | 排除規則 |

## 性能建議

- 能用 `r/s` 就不要用 `xhr`。
- `xhr` 只在必要時使用，並盡量限制 `url` 與選擇器範圍。
- 規則越精確，誤命中越少，整體性能越穩。