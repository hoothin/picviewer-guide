---
title: 运行机制与匹配流程
---

# 运行机制与匹配流程

脚本会在页面中持续监听鼠标与图片元素，并执行规则匹配与图片地址解析。

## 核心流程

1. **匹配站点**：根据规则中的 `url` 判断是否启用该条规则。
2. **匹配图片**：根据 `src`、`r/s` 或 `getImage` 解析原图地址。
3. **处理非图元素**：通过 `ext` 或 `getExtSrc` 寻找附近图片。
4. **内页抓取**：必要时使用 `xhr` 抓取内页并提取图片。
5. **返回结果**：将解析出的 URL 交给浮动工具栏与画廊。

## 处理懒加载

脚本内置多种懒加载属性扫描，可自动从 `data-*` 属性中提取真实图片地址。\n
如果目标站点使用特殊字段，可在规则中指定 `lazyAttr`。

## 结果复用

解析完成的地址会在后续操作中复用，例如画廊收集、批量下载与以图搜图。
